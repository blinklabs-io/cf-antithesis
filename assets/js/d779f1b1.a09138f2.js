"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[5528],{7070:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"ops/agent-role","title":"Agent role manual","description":"White-list repositories","source":"@site/docs/ops/agent-role.md","sourceDirName":"ops","slug":"/ops/agent-role","permalink":"/moog/docs/ops/agent-role","draft":false,"unlisted":false,"editUrl":"https://github.com/cardano-foundation/moog/tree/main/docs/docs/ops/agent-role.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Oracle role manual","permalink":"/moog/docs/ops/oracle-role"},"next":{"title":"Real-World Scenario","permalink":"/moog/docs/ops/real-world"}}');var o=n(4848),r=n(8453),a=n(8972);const i={},l="Agent role manual",c={},d=[{value:"White-list repositories",id:"white-list-repositories",level:2},{value:"White-list a repository",id:"white-list-a-repository",level:3},{value:"Black-list a repository",id:"black-list-a-repository",level:3},{value:"Query pending test-runs",id:"query-pending-test-runs",level:2},{value:"Download a test-run assets",id:"download-a-test-run-assets",level:2},{value:"Start a test-run locally",id:"start-a-test-run-locally",level:2},{value:"Reject a test-run",id:"reject-a-test-run",level:2},{value:"Push a test-run to antithesis platform",id:"push-a-test-run-to-antithesis-platform",level:2},{value:"Report the acceptance of a test-run on-chain",id:"report-the-acceptance-of-a-test-run-on-chain",level:2},{value:"Check for the completion of a test-run",id:"check-for-the-completion-of-a-test-run",level:2},{value:"Report the completion of a test-run on-chain",id:"report-the-completion-of-a-test-run-on-chain",level:2}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"agent-role-manual",children:"Agent role manual"})}),"\n",(0,o.jsx)(t.h2,{id:"white-list-repositories",children:"White-list repositories"}),"\n",(0,o.jsx)(t.p,{children:"In the interest of avoiding spam the agenthas to white-list repositories before the oracle will accept test-runs for them."}),"\n",(0,o.jsx)(t.p,{children:"Two commands are available"}),"\n",(0,o.jsx)(t.h3,{id:"white-list-a-repository",children:"White-list a repository"}),"\n",(0,o.jsx)(a.A,{src:"/moog/video/whitelist-repo.cast",options:{autoplay:!1,theme:"asciinema",speed:1}}),"\n",(0,o.jsx)(t.p,{children:"This will only work if the repository is not already white-listed and the repository is in GitHub."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"moog agent white-list <platform> <repository>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["ATM only GitHub is supported as a platform.\nThe format of the repository is ",(0,o.jsx)(t.code,{children:"<owner>/<repository>"}),", e.g. ",(0,o.jsx)(t.code,{children:"cardano-foundation/moog"}),"."]}),"\n",(0,o.jsx)(t.h3,{id:"black-list-a-repository",children:"Black-list a repository"}),"\n",(0,o.jsx)(a.A,{src:"/moog/video/blacklist-repo.cast",options:{autoplay:!1,theme:"asciinema",speed:1}}),"\n",(0,o.jsx)(t.p,{children:"This will only work if the repository is white-listed."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"moog agent black-list <platform> <repository>\n"})}),"\n",(0,o.jsx)(t.h2,{id:"query-pending-test-runs",children:"Query pending test-runs"}),"\n",(0,o.jsx)(t.p,{children:"The agent is responsible for managing test-runs from pending to running and completed."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"moog facts test-runs pending --pretty\n"})}),"\n",(0,o.jsx)(t.p,{children:"will report all the pending test runs in a human friendly format."}),"\n",(0,o.jsx)(t.h2,{id:"download-a-test-run-assets",children:"Download a test-run assets"}),"\n",(0,o.jsx)(t.p,{children:"Once a test-run is pending the agent can download the assets for the test-run."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"moog agent download -i <test-run-id> -D <directory>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["This will download the assets for the test-run with id ",(0,o.jsx)(t.code,{children:"<test-run-id>"})," into the directory ",(0,o.jsx)(t.code,{children:"<directory>"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"start-a-test-run-locally",children:"Start a test-run locally"}),"\n",(0,o.jsx)(t.p,{children:"At the moment there is no moog-cli command to start a test-run locally. But a minimal check could be done via docker compose."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"cd <directory>\nINTERNAL_NETWORK=true docker compose up --build\n"})}),"\n",(0,o.jsx)(t.p,{children:"Obviously you should do all kind of analysis you deem necessary on the assets before deciding the next step."}),"\n",(0,o.jsx)(t.h2,{id:"reject-a-test-run",children:"Reject a test-run"}),"\n",(0,o.jsx)(t.p,{children:"If the agent decides a test-run is not acceptable it can reject it."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"moog agent reject-test -i <test-run-id> --reason <reason>\n"})}),"\n",(0,o.jsx)(t.h2,{id:"push-a-test-run-to-antithesis-platform",children:"Push a test-run to antithesis platform"}),"\n",(0,o.jsx)(t.p,{children:"Once decided a test-run is acceptable the agent can push the test-run to the antithesis platform."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"moog agent push-test -i <test-run-id> -D <directory>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["This will push the test-run with id ",(0,o.jsx)(t.code,{children:"<test-run-id>"})," to the antithesis platform"]}),"\n",(0,o.jsx)(t.h2,{id:"report-the-acceptance-of-a-test-run-on-chain",children:"Report the acceptance of a test-run on-chain"}),"\n",(0,o.jsx)(t.p,{children:"Once a test-run is pushed to the antithesis platform the agent has to report the acceptance of the test-run on-chain."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"moog agent accept-test -i <test-run-id>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["This will move it from ",(0,o.jsx)(t.code,{children:"pending"})," to ",(0,o.jsx)(t.code,{children:"running"})," state in the facts."]}),"\n",(0,o.jsx)(t.h2,{id:"check-for-the-completion-of-a-test-run",children:"Check for the completion of a test-run"}),"\n",(0,o.jsx)(t.p,{children:"ATM we can only collect results via email.\nThe email is passed in the post request when the test-run on the recipients list."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:'export MOOG_AGENT_EMAIL="<your-email>"\n'})}),"\n",(0,o.jsx)(t.p,{children:"Then you can check for the completion of a test-run via"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"moog agent collect-results-for --test-run-id <test-run-id> --days <n> --ask-agent-email-password\n"})}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsx)(t.p,{children:"HAL Team"}),"\n",(0,o.jsx)(t.p,{children:"To use your CF email you have to use an app password. If you use your password you  will get an error like"}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.code,{children:"LoginFailed user error (NO: Application-specific password required: https://support.google.com/accounts/answer/185833 (Failure))"})}),"\n",(0,o.jsxs)(t.p,{children:["Just go to ",(0,o.jsx)(t.a,{href:"https://myaccount.google.com/apppasswords",children:"https://myaccount.google.com/apppasswords"})," and create an app password."]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"report-the-completion-of-a-test-run-on-chain",children:"Report the completion of a test-run on-chain"}),"\n",(0,o.jsx)(t.p,{children:"Once the result URL is retrieved the agent has to report the completion of the test-run on-chain."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"moog agent report-test -i <test-run-id> --url <result-url>  --duration <duration-in-hours>\n"})}),"\n",(0,o.jsx)(t.p,{children:"The URL is encrypted automatically with the requester's public key."})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>i});var s=n(6540);const o={},r=s.createContext(o);function a(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(r.Provider,{value:t},e.children)}},8972:(e,t,n)=>{n.d(t,{A:()=>r});var s=n(6540),o=n(4848);function r({src:e,options:t={}}){const r=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let s;return(async()=>{const o=await n.e(459).then(n.bind(n,459)),a=o.default||o;r.current&&a?.create?s=a.create(e,r.current,t):console.error("Failed to load AsciinemaPlayer or its create() method")})(),()=>{s=null}},[e,t]),(0,o.jsx)("div",{ref:r})}}}]);