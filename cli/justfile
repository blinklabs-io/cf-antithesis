# shellcheck shell=bash

format:
   #!/usr/bin/env bash
   fourmolu -i src app test CI/rewrite-libs
   cabal-fmt -i anti.cabal CI/rewrite-libs/rewrite-libs.cabal
   nixfmt *.nix
   nixfmt nix/*.nix
   nixfmt CI/rewrite-libs/*.nix
   nixfmt CI/rewrite-libs/nix/*.nix

hlint:
  #!/usr/bin/env bash
  hlint app src test CI/rewrite-libs

test:
  #!/usr/bin/env bash
  cabal test

build:
    #!/usr/bin/env bash
    cabal build all

E2E:
    #!/usr/bin/env bash
    mkdir -p tmp/bin
    cabal install --installdir=tmp >/dev/null
    export PATH="$PWD/tmp:$PATH"
    ./test/scenarios/rejectATestRun.sh
    ./test/scenarios/acceptATestRun.sh

CI:
  #!/usr/bin/env bash
  set -euo pipefail
  just build
  just test
  just E2E
  cabal-fmt -c anti.cabal CI/rewrite-libs/rewrite-libs.cabal
  fourmolu -m check src app test CI/rewrite-libs
  hlint -c src app test CI/rewrite-libs
